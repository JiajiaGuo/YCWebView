#### 基础使用目录介绍
- 01.进度条场景分析
- 02.第一种解决方案
- 03.第二种解决方案
- 04.第三种解决方案



### 01.进度条场景分析
- 网页需要在我们加载完成后需要去关闭自定义进度条
    - 如果是一个没有重定向的网页加载这样是没有问题的
    - 如果你的页面重定向了并且还有可能是多次的，我们的在onPageStarted和onPageFinished会回调多次，就会导致进度条出现重复加载
- 为何会回调多次onPageFinished
    - 重定向导致。举个例子，比如跳转天猫首页，会判断是否登陆，如果没有登陆则重定向到登陆注册页面。



### 02.第一种解决方案
- 如果我们想要自定义进度条，就要考虑如何避免重定向行为造成的多次加载这种情况，（也许你的场景不需要这种保护）。我的解决方式是这样的：设置一个Boolean全局变量flag，
- 1、在onPageStarted()中设置为true，若加载样式没有开启，就开启进度条等加载样式，
- 2、在onPageFinished()中检测，如果为true，就说明已经是目的地址了，可以关闭加载样式了，如果是false，就不做处理，继续等待，
- 3、在shouldOverrideUrlLoading()中，设置为false，若加载样式没有开启，就开启进度条等加载样式


### 03.第二种解决方案
- 第二种解决方案
    ```
    Webview.setWebViewClient(new WebViewClient() {
        int running = 0;
        @Override
        public boolean shouldOverrideUrlLoading(WebView view, String url) {
            view.loadUrl(url);
            running++;
            return true;
        }
    
        @Override
        public void onPageStarted(WebView webView, String s, Bitmap bitmap) {
            super.onPageStarted(webView, s, bitmap);
            running = Math.max(running, 1);
        }
    
        @Override
        public void onPageFinished(WebView view, String url) {
            super.onPageFinished(view, url);
            if (--running==0) {
                //做操作，隐藏加载进度条或者加载loading
            }
        }
    });
    ```


### 04.第三种解决方案
- 在自定义进度条中，定义一个记录状态(已经开始状态，已经结束状态，不能继续开始状态)的临时变量。
- 1.在设置进度条进度动画的时候，标记为已经开始状态；
- 2.当进度条达到95以上时，表明页面几乎加载完成，这时候标记为已经结束状态；
- 3.当进度条动画监听结束后，将状态标记为不能继续开始状态；
- 这个时候，即使页面有多次重定向，执行多次onPageStarted->onPageFinished方法，也不会出现一次进度条没跑完又出现第二次进度条。具体代码看lib中的WebProgress代码！





### 5.1.0 可以提前显示加载进度条
- 提前显示进度条不是提升性能，但是对用户体验来说也是很重要的一点 ， WebView.loadUrl("url") 不会立马就回调 onPageStarted 或者 onProgressChanged 因为在这一时间段，WebView 有可能在初始化内核，也有可能在与服务器建立连接，这个时间段容易出现白屏，白屏用户体验是很糟糕的 ，所以建议
    ```
    //正确
    pb.setVisibility(View.VISIBLE);
    mWebView.loadUrl("https://github.com/yangchong211/LifeHelper");
    
    //不太好
    @Override
    public void onPageStarted(WebView webView, String s, Bitmap bitmap) {
        super.onPageStarted(webView, s, bitmap);
        //设定加载开始的操作
        pb.setVisibility(View.VISIBLE);
    }
    
    //下面这个是监听进度条进度变化的逻辑
    mWebView.getX5WebChromeClient().setWebListener(interWebListener);
    mWebView.getX5WebViewClient().setWebListener(interWebListener);
    private InterWebListener interWebListener = new InterWebListener() {
        @Override
        public void hindProgressBar() {
            pb.setVisibility(View.GONE);
        }

        @Override
        public void showErrorView() {

        }

        @Override
        public void startProgress(int newProgress) {
            pb.setProgress(newProgress);
        }

        @Override
        public void showTitle(String title) {

        }
    };
    ```









