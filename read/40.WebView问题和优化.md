#### 目录介绍



### 06.关于一些问题和优化
- 影响页面加载的一些因素有那些？
    - 1.加载网页中，如果图片很多，而这些图片的请求又是一个个独立并且串行的请求。那么可能会导致加载页面比较缓慢……
    - 2.app原生和webView中请求，都会涉及到https的网络请求，那么在请求前会有域名dns的解析，这个也会有大约200毫秒的解析时间(主要耗费时间dns，connection，服务器处理等)……
    - 3.webView加载html网页时，有些js一直在执行比如动画之类的东西，此刻webView挂在了后台这些资源是不会被释放用户也无法感知。导致耗费资源……
    - 4.关于加载loading或者加载进度条，不一定要放到onPageStarted开始执行即显示出来，因为webView从创建到这个方法会有一个时间……
    - 5.webView默认开启密码保存功能，如果网页涉及到用户登陆，密码会被明文保到 /data/data/com.package.name/databases/webview.db 中，这样就有被盗取密码的危险……
    - 6.h5页面被拦截或者注入广告，重定向，或者DNS劫持。一般跟连接的wifi有关系（http劫持），也可能跟运营商有关系(dns劫持)
- 具体可以操作的优化分析
    - 1.加载webView中的资源时，针对图片，等页面finish后再发起图片加载(也就是执行onPageFinished设置加载图片)。具体看[5.0.2图片加载次序优化](https://github.com/yangchong211/YCWebView/wiki/5.1-webView%E4%BC%98%E5%8C%961)
    - 2.[DNS域名解析](https://github.com/yangchong211/YCBlogs/blob/master/net/%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/04.%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90DNS.md)采用和客户端API相同的域名， DNS会在系统级别进行缓存，对于WebView的地址，如果使用的域名与native的API相同，则可以直接使用缓存的DNS而不用再发起请求图片。具体看[5.0.7 DNS采用和客户端API相同的域名](https://github.com/yangchong211/YCWebView/wiki/5.1-webView%E4%BC%98%E5%8C%961)
    - 3.在后台的时候，会调用onStop方法，即此时关闭js交互，回到前台调用onResume再开启js交互。具体看[5.0.9 后台无法释放js导致发热耗电](https://github.com/yangchong211/YCWebView/wiki/5.1-webView%E4%BC%98%E5%8C%961)
    - 4.提前显示进度条不是提升性能，但是对用户体验来说也是很重要的一点 ，WebView.loadUrl("url") 不会立马就回调onPageStarted方法，因为在这一时间段，WebView 有可能在初始化内核，也有可能在与服务器建立连接，这个时间段容易出现白屏
    - 5.需要通过 WebSettings.setSavePassword(false) 关闭密码保存功能。
    - 6.一般可以处理：1使用https代替http；2.添加白名单(比如添加自己网站的host，其他不给访问)；3.对页面md5校验(不太好)。设置白名单参考：[5.0.8 如何设置白名单操作](https://github.com/yangchong211/YCWebView/wiki/5.1-webView%E4%BC%98%E5%8C%961)
- 还有一些其他的优化小细节
    - a.WebView处理404、500逻辑，在WebChromeClient子类中可以重写他的onReceivedTitle()方法监听标题，还有在WebChromeClient子类中onReceivedHttpError可以监听statusCode。具体操作看[5.1.5 WebView处理404、500逻辑](https://github.com/yangchong211/YCWebView/wiki/5.1-webView%E4%BC%98%E5%8C%961)
    - b.如果不显示图片，开发的时候可能使用的是https的链接, 但是链接中的图片可能是http的，需要开启设置。具体看：[4.1.4 webView加载网页不显示图片](https://github.com/yangchong211/YCWebView/wiki/4.1-%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB%E4%BB%8B%E7%BB%8D1)
    - c.evaluateJavascript(String var1, ValueCallback<String> var2)中url长度有限制，在19以上超过2097152个字符失效，这个地方可以加个判断。不过一般很难碰到……具体可以参考：[4.3.1 Android与js传递数据大小有限制](https://github.com/yangchong211/YCWebView/wiki/4.3-%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB%E4%BB%8B%E7%BB%8D3)
    - d.在web页面android软键盘覆盖问题，常见的有android:windowSoftInputMode的值adjustPan或者adjustResize即可，如果webView是全屏模式则仍然会出现问题。具体看：[4.6.1 在web页面android软键盘覆盖问题](https://github.com/yangchong211/YCWebView/wiki/4.4-%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB%E4%BB%8B%E7%BB%8D4)
    - e.关于WebView隐藏H5页面中的某个标签视图，大概操作就是在页面加载完成，通过getElementsByClassName找到h5中标签name，然后手动写function方法隐藏标签。但加载时机很关键，不过会造成闪屏和多次加载。具体看：[4.6.6 WebView如何隐藏H5的部分内容问题](https://github.com/yangchong211/YCWebView/wiki/4.5-%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB%E4%BB%8B%E7%BB%8D5)
    - f.页面重定向，会导致onPageStarted多次执行，那么这个时候如何避免加载进度条出现执行多次，或者跳动的问题。具体可见：[09.web进度条避免多次加载](https://github.com/yangchong211/YCWebView/wiki/6.1-webView%E5%9F%BA%E7%A1%801)
    - g.建议开启Google安全浏览服务，用户访问不安全网页会提示安全问题；webView使用上的建议设置布局高度和宽度设置为 match_parent；具体可见[48.开启Google安全浏览服务](https://github.com/yangchong211/YCWebView/wiki/6.4-webView%E5%9F%BA%E7%A1%804)






